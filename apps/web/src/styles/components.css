/* =========================================================
   SYNTHOMA UI CORE — sjednoceno, bez duplicit, theme-aware
   Sekce: Utilities • Typography • ScrambleTitle • Hero
           Control Panel • Loaders/Overlays • Modal • Error
           Video/Noise/GlitchBG • Text FX • Keyframes • A11y
   ========================================================= */

/* =========================
   UTILITIES (glass/panel/btn/halo/CRT/fog)
   ========================= */
   .glass {
    background: var(--bg-glass);
    -webkit-backdrop-filter: blur(var(--app-bg-blur, var(--glass-blur, 8px)));
    backdrop-filter: blur(var(--app-bg-blur, var(--glass-blur, 8px)));
    border: 1px solid var(--border-tertiary);
  }

  /* Heading truncation: clamp to 2 lines in reader/hero, allow wrapping, show ellipsis */
  .SYNTHOMAREADER h1,
  .SYNTHOMAREADER h2,
  .SYNTHOMAREADER h3,
  .hero-intro h1,
  .hero-intro h2,
  .hero-intro h3 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: normal;
    word-break: break-word;
    overflow-wrap: anywhere;
  }

/* Fine-tune per heading level without wrapping */
h2.title { --title-size: clamp(1.35rem, 5.2vw, 2.8rem); }
h3.title { --title-size: clamp(1.2rem, 4.6vw, 2.3rem); }


  /* Retro Arcade: pixelated background video */
  body[data-theme="retro-arcade"] .video-background video {
    /* Keep same sizing as other themes */
    position: absolute; inset: 0;
    width: 100%; height: 100%;
    object-fit: cover;
    transform: none; transform-origin: center;
    /* Only add subtle tuning if video is visible (canvas may hide it) */
    image-rendering: -webkit-optimize-contrast; /* Edge/Safari fallback */
    image-rendering: pixelated;
    opacity: var(--video-opacity, 1);
    /* Use theme's base filter like other themes (no custom override) */
    filter: var(--filter-primary, none);
  }

  /* Retro pixelation canvas overlay: nechte videa viditelná, canvas funguje jako filtr */
  #retro-video-canvas {
    position: absolute; inset: 0; width: 100%; height: 100%;
    pointer-events: none; image-rendering: -webkit-optimize-contrast; image-rendering: pixelated;
    z-index: 1;
  }

  /* Kill glitch background in retro theme (no blinking over pixels) */
  body[data-theme="retro-arcade"] #glitch-bg { display: none !important; opacity: 0 !important; }
  
  .panel {
    /* jednotný panel s řízenou průhledností (slider nastavuje --panel-alpha) */
    background: rgba(var(--bg-secondary-rgb, 0,0,0), var(--panel-alpha, 0.6));
    -webkit-backdrop-filter: blur(4px);
    backdrop-filter: blur(4px);
    border: 1px solid var(--border-secondary);
    box-shadow: var(--shadow-glow, 0 0 12px rgba(0,255,255,.25));
  }
  
  .accent { color: var(--text-accent); }
  
  .btn {
    color: var(--text-primary);
    background: linear-gradient(180deg, var(--bg-tertiary), var(--bg-secondary));
    border: 1px solid var(--border-primary);
    box-shadow: 0 0 0 0 var(--glow-secondary);
    transition: transform .12s ease, box-shadow .12s ease;
  }
  .btn:hover { transform: translateY(-1px); box-shadow: 0 0 14px var(--glow-secondary); }
  
  .halo {
    color: var(--text-primary);
    text-shadow: 0 0 6px var(--glow-secondary), 0 0 14px var(--glow-primary);
  }
  
  /* ---- Layout utility classes (for removing inline styles) ---- */
  .p-12 { padding: 12px; }
  .p-16 { padding: 16px; }
  .p-8-12 { padding: 8px 12px; }
  .m-16 { margin: 16px; }
  .mb-12 { margin-bottom: 12px; }
  .mt-8 { margin-top: 8px; }
  .mt-12 { margin-top: 12px; }
  .ml-auto { margin-left: auto; }
  .rounded-12 { border-radius: 12px; }
  .text-left { text-align: left; }
  
  .flex { display: flex; }
  .grid { display: grid; }
  .items-baseline { align-items: baseline; }
  .items-center { align-items: center; }
  .gap-6 { gap: 6px; }
  .gap-8 { gap: 8px; }
  .gap-16 { gap: 16px; }
  .flex-wrap { flex-wrap: wrap; }
  
  .opacity-70 { opacity: .7; }
  .opacity-75 { opacity: .75; }
  .opacity-90 { opacity: .9; }
  
  .overlay-center { display: grid; place-items: center; }
  .bg-overlay { background: var(--bg-overlay); }
  
  /* Button size variants and state based on aria-pressed */
  .btn-sm { padding: 4px 8px; border-radius: 8px; }
  .btn-lg { padding: 8px 12px; border-radius: 10px; }
  .btn[aria-pressed="true"] { opacity: 1; }
  .btn[aria-pressed="false"] { opacity: .8; }
 
  /* Button variants (unified across app) */
  .btn-secondary {
    background: linear-gradient(180deg, color-mix(in oklab, var(--bg-tertiary) 70%, transparent), color-mix(in oklab, var(--bg-secondary) 85%, transparent));
    border-color: var(--border-secondary);
    color: var(--text-secondary);
  }
  .btn-secondary:hover { box-shadow: 0 0 12px var(--glow-secondary); }
 
  .btn-outline {
    background: transparent;
    border: 1px solid var(--border-primary);
    color: var(--text-primary);
  }
  .btn-outline:hover { background: color-mix(in oklab, var(--bg-secondary) 20%, transparent); }
 
  .btn-ghost {
    background: transparent;
    border: 1px solid transparent;
    color: var(--text-secondary);
  }
  .btn-ghost:hover {
    background: color-mix(in oklab, var(--bg-secondary) 12%, transparent);
    border-color: var(--border-secondary);
  }
 
  /* Chip/Badge utilities */
  .chip {
    display: inline-flex; align-items: center; gap: .4rem;
    padding: .25rem .55rem; border-radius: 999px;
    background: color-mix(in oklab, var(--bg-secondary) 65%, transparent);
    border: 1px solid var(--border-secondary);
    color: var(--text-secondary);
    font-family: var(--font-family-primary);
    font-size: .95rem; line-height: 1; white-space: nowrap;
  }
  .chip-accent { background: color-mix(in oklab, var(--accent-primary) 12%, transparent); color: var(--text-primary); border-color: var(--accent-primary); }
  .chip-muted { opacity: .8; }
  .chip-sm { padding: .15rem .45rem; font-size: .85rem; }
 
  .badge { 
    display: inline-block; padding: .12rem .45rem; border-radius: 6px;
    background: color-mix(in oklab, var(--bg-secondary) 55%, transparent);
    border: 1px solid var(--border-secondary); color: var(--text-secondary);
    font-size: .85rem; line-height: 1; vertical-align: middle;
  }
  .badge-accent { background: color-mix(in oklab, var(--accent-primary) 10%, transparent); border-color: var(--accent-primary); color: var(--text-primary); }
  .badge-space { margin-left: .5rem; }
  
  /* === Global: disable text selection & image dragging === */
  :where(html, body, *) {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
  /* A11y/UX: allow selecting/copying chapter text inside the reader */
  .SYNTHOMAREADER .reader-host,
  .SYNTHOMAREADER .reader-host * {
    -webkit-user-select: text;
    -moz-user-select: text;
    -ms-user-select: text;
    user-select: text;
  }
  img, svg, canvas, video {
    -webkit-user-drag: none; /* Safari/Chrome */
    pointer-events: auto;
  }
  .crt { position: relative; overflow: hidden; background: var(--bg-secondary); }
  .crt::after {
    content: ""; position: absolute; inset: 0; pointer-events: none;
    background:
      linear-gradient(rgba(255,255,255,.02), rgba(0,0,0,.08)),
      repeating-linear-gradient(0deg, rgba(255,255,255,.03), rgba(255,255,255,.03) 1px, transparent 1px, transparent 2px);
    mix-blend-mode: overlay; opacity: .8;
  }
  
  .fog { position: relative; }
  .fog::before {
    content: ""; position: absolute; inset: -20%; pointer-events: none;
    background:
      radial-gradient(circle at 50% 20%, rgba(var(--bg-secondary-rgb), .1), transparent 60%),
      radial-gradient(circle at 20% 80%, rgba(var(--bg-secondary-rgb), .1), transparent 60%);
    filter: blur(8px);
  }
  
  /* jemný textový shift bez přepisování znaků */
  .glitchy {
    text-shadow: 1px 0 var(--accent-primary), -1px 0 var(--accent-secondary);
    animation: glitch-shift .9s steps(2,end) infinite;
  }
  @keyframes glitch-shift {
    0%,100% { transform: translate(0,0); }
    50% { transform: translate(.5px,-.5px); }
  }
  
  /* utility */
  .title-sm { font-size: calc(1.3rem * var(--font-size-multiplier)) !important; }
  .ff-text01 { font-family: 'Text01', monospace !important; }
  .popup-tip { cursor: help; text-decoration: underline dotted; text-underline-offset: 2px; }

  /* =========================
     TEXT FX (utilities)
     ========================= */
  /* 1) Neon cyan glow */
  .fx-neon {
    color: var(--text-primary);
    text-shadow: 0 0 6px var(--glow-primary), 0 0 12px var(--glow-primary), 0 0 18px var(--glow-secondary);
  }

  /* 2) Strong magenta glow */
  .fx-glow-magenta { text-shadow: 0 0 4px #f0f, 0 0 10px #f0f, 0 0 18px #f0f; }

  /* 3) Deep shadow for contrast on bright bg */
  .fx-shadow-lg { text-shadow: 0 2px 0 rgba(0,0,0,.35), 0 4px 12px rgba(0,0,0,.5); }

  /* 4) Outline stroke using multiple text-shadows (fallback for -webkit-text-stroke) */
  .fx-outline {
    /* Default: faint ghosted outline, barely readable until toggled */
    text-shadow:
      -1px -1px 0 color-mix(in oklab, currentColor 18%, transparent),
       1px -1px 0 color-mix(in oklab, currentColor 18%, transparent),
      -1px  1px 0 color-mix(in oklab, currentColor 18%, transparent),
       1px  1px 0 color-mix(in oklab, currentColor 18%, transparent);
    color: transparent; /* keep layout stable */
    /* Fallback for older browsers */
    -webkit-text-stroke: 0.6px currentColor;
    /* Modern nicer mix for subtle stroke */
    -webkit-text-stroke: 0.6px color-mix(in oklab, currentColor 35%, transparent);
    opacity: .65;
    transition: color .18s ease, text-shadow .18s ease, opacity .18s ease, -webkit-text-stroke-color .18s ease, -webkit-text-stroke-width .18s ease;
  }

  /* Lit state: filled + bright glow */
  .fx-outline.is-lit {
    color: var(--text-primary);
    /* Fallback first */
    -webkit-text-stroke: 0.5px currentColor;
    /* Then modern mix for richer look */
    -webkit-text-stroke: 0.5px color-mix(in oklab, var(--text-primary) 55%, transparent);
    text-shadow:
      0 0 6px var(--glow-primary),
      0 0 12px var(--glow-primary),
      0 0 18px var(--glow-secondary);
    opacity: 1;
  }

  /* Keyboard focus hint for togglable outline items */
  .fx-outline:focus-visible { outline: 2px solid var(--accent-primary); outline-offset: 2px; }

  @media (prefers-reduced-motion: reduce) {
    .fx-outline { transition: none !important; }
  }

  /* 5) Scanline shimmer (subtle CRT-like pass) */
  .fx-scanline { position: relative; }
  .fx-scanline::after {
    content: ""; position: absolute; inset: 0; pointer-events: none;
    background: repeating-linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.06) 1px, transparent 1px, transparent 3px);
    mix-blend-mode: overlay; opacity: .35;
  }

  /* 6) Flicker (arcade bulb) */
  .fx-flicker { animation: fx-flicker 2.2s infinite; }
  @keyframes fx-flicker {
    0%, 19%, 21%, 23%, 80%, 100% { opacity: 1; text-shadow: 0 0 8px var(--glow-primary), 0 0 16px var(--glow-secondary); }
    20%, 22% { opacity: .4; text-shadow: none; }
    81% { opacity: .85; }
  }

  /* 7) Wave (apply to inline elements or wrap words in spans) */
  .fx-wave { display: inline-block; animation: fx-wave 1.8s ease-in-out infinite; }
  @keyframes fx-wave { 0%,100%{ transform: translateY(0) } 50%{ transform: translateY(-2px) } }

  /* 8) Gradient text (static) */
  .fx-gradient {
    background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
    -webkit-background-clip: text; background-clip: text; color: transparent;
    text-shadow: none;
  }

  /* 9) Animated rainbow text */
  .fx-rainbow {
    background: linear-gradient(90deg, #ff004c, #ffbf00, #00ff95, #00b3ff, #c300ff, #ff004c);
    background-size: 300% 100%;
    -webkit-background-clip: text; background-clip: text; color: transparent;
    animation: fx-rainbow 6s linear infinite;
  }
  @keyframes fx-rainbow { 0%{ background-position: 0% 50% } 100%{ background-position: 100% 50% } }

  /* 10) Noise mask for gritty text */
  .fx-noise { position: relative; }
  .fx-noise::after {
    content: ""; position: absolute; inset: -2px; mix-blend-mode: overlay; pointer-events: none; opacity: .35;
    /* CSS-only speckle noise using layered gradients */
    background-image:
      radial-gradient(circle at 15% 20%, rgba(255,255,255,.07) 2px, transparent 2px),
      radial-gradient(circle at 40% 80%, rgba(255,255,255,.05) 1.5px, transparent 1.5px),
      radial-gradient(circle at 75% 35%, rgba(255,255,255,.06) 1px, transparent 1px),
      radial-gradient(circle at 90% 60%, rgba(255,255,255,.04) 1px, transparent 1px),
      radial-gradient(circle at 25% 55%, rgba(255,255,255,.05) 1.5px, transparent 1.5px);
    background-size: 8px 8px, 10px 10px, 12px 12px, 14px 14px, 16px 16px;
    background-repeat: repeat;
    filter: contrast(1.12) brightness(1.04);
  }

  /* 11) Uppercase with tracking */
  .fx-uppercase-wide { text-transform: uppercase; letter-spacing: .12em; }

  /* 12) Cyber underline (glow line under text) */
  .fx-underline {
    position: relative; text-decoration: none;
  }
  .fx-underline::after {
    content: ""; position: absolute; left: 0; right: 0; bottom: -2px; height: 2px;
    background: linear-gradient(90deg, var(--accent-primary), transparent, var(--accent-secondary));
    box-shadow: 0 0 8px var(--glow-primary);
  }

  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .fx-flicker, .fx-wave, .fx-rainbow { animation: none !important; }
  }
  
  /* =========================
     TYPOGRAPHY (theme-aware)
     ========================= */
  h1 {
    font-family: 'Synthoma', monospace;
    font-weight: 700;
    font-size: calc(3rem * var(--font-size-multiplier));
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--text-primary);
    text-shadow: 0 0 5px var(--glow-secondary), 0 0 10px var(--glow-secondary);
    margin: 0;
    max-width: 100%;
    white-space: normal;
    overflow-wrap: anywhere;
    word-break: break-word;
  }
  h2 {
    font-family: 'Synthoma', monospace;
    font-weight: 700;
    font-size: calc(1.7rem * var(--font-size-multiplier));
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--text-primary);
    text-shadow: 0 0 5px var(--glow-secondary), 0 0 10px var(--glow-secondary);
    margin: 0;
    max-width: 100%;
    white-space: normal;
    overflow-wrap: anywhere;
    word-break: break-word;
  }
  h3 {
    font-family: 'Text01', monospace;
    position: relative;
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1.4;
    font-size: calc(1.5rem * var(--font-size-multiplier));
    text-align: center;
    text-shadow: 0 0 15px var(--glow-secondary), 0 0 20px var(--glow-primary);
    margin: 0 .1rem;
    padding: .5rem 1rem .5rem .5rem;
    z-index: 10;
    /* Allow wrapping */
    display: block;
    max-width: 100%;
    overflow: visible; /* allow glow/shadows */
    white-space: normal;
    overflow-wrap: anywhere;
    word-break: break-word;
    font-size: var(--title-size, clamp(1.2rem, 4.6vw, 2.2rem));
  }
  
  h4, h5, h6 {
    font-family: 'Text01', monospace;
    font-weight: bold;
    color: var(--text-primary);
    font-size: calc(1.7rem * var(--font-size-multiplier));
    line-height: 1.6;
    margin: 0;
    padding: 0.5rem 1rem;
    word-break: keep-all;
    overflow-wrap: break-word;
    -webkit-hyphens: manual;
    hyphens: manual;
    max-width: 100%;
    box-sizing: border-box;
    white-space: normal;
    text-align: left;
    opacity: .88;
    transition: color .3s ease, text-shadow .3s ease;
  }
  p {
    font-family: 'Text03', monospace;
    font-weight: 400;
    color: var(--text-primary);
    font-size: calc(1.1rem * var(--font-size-multiplier));
    line-height: 1.4;
    text-align: left;
    margin: 0 1rem;
    padding: 0.5rem 1rem;
    z-index: 10;
    text-shadow: 0 0 6px var(--shadow-primary);
  }
  
  /* blokové typové utilitky */
  .title {
    font-family: 'Synthoma', monospace;
    position: relative;
    left: 0.75rem;
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1.4;
    font-size: calc(1.8rem * var(--font-size-multiplier));
    text-align: center;
    text-shadow: 0 0 15px var(--glow-secondary), 0 0 20px var(--glow-primary);
    z-index: 10;
  }

  .title::before {
    content: '';
    position: absolute;
    left: -0.5rem;
    width: 4px;
    height: 100%;
    border-radius: 2px;
    background: rgb(0, 255, 255, 0);
    box-shadow: -1px 0 4px 0px #0ff, 1px 0 8px 0px #ff00ff, 0px 0 12px 0px #faff00;
    animation: border-glow 2.6s infinite cubic-bezier(.8,0,.23,1.1);
}

/* Lit state: filled + bright glow */
.fx-outline.is-lit {
color: var(--text-primary);
/* Fallback first */
-webkit-text-stroke: 0.5px currentColor;
/* Then modern mix for richer look */
-webkit-text-stroke: 0.5px color-mix(in oklab, var(--text-primary) 55%, transparent);
text-shadow:
0 0 6px var(--glow-primary),
0 0 12px var(--glow-primary),
0 0 18px var(--glow-secondary);
opacity: 1;
    white-space: nowrap;
    overflow: visible; /* allow glow/char jitter */
    display: inline-block;
  }

  /* Zvýšení priority uvnitř čtečky, aby jiné globální styly nepřebíjely kapitoly */
  .SYNTHOMAREADER .log,
  .SYNTHOMAREADER .dialog,
  .SYNTHOMAREADER .dialogS,
  .SYNTHOMAREADER .dialogN,
  .SYNTHOMAREADER .text,
  .SYNTHOMAREADER .textV,
  .SYNTHOMAREADER .title {
    display: block;
  }

  /* Reader line alignment: unify spacing so the left border (::before) aligns consistently */
  .SYNTHOMAREADER .tw-line.log,
  .SYNTHOMAREADER .tw-line.dialog,
  .SYNTHOMAREADER .tw-line.dialogS,
  .SYNTHOMAREADER .tw-line.dialogN,
  .SYNTHOMAREADER .tw-line.text,
  .SYNTHOMAREADER .tw-line.title,
  .SYNTHOMAREADER .log,
  .SYNTHOMAREADER .dialog,
  .SYNTHOMAREADER .dialogS,
  .SYNTHOMAREADER .dialogN,
  .SYNTHOMAREADER .text,
  .SYNTHOMAREADER .title,
  .SYNTHOMAREADER .tw-line.log,
  .SYNTHOMAREADER .tw-line.dialog,
  .SYNTHOMAREADER .tw-line.dialogS,
  .SYNTHOMAREADER .tw-line.dialogN,
  .SYNTHOMAREADER .tw-line.text,
  .SYNTHOMAREADER .tw-line.title {
    margin-left: 0rem;                 /* remove per-class margin drift */
    line-height: 1.2;
  }

  /* Dialog indentation (simulate a single-tab indent for text content only) */
  .SYNTHOMAREADER .dialog,
  .SYNTHOMAREADER .dialogS,
  .SYNTHOMAREADER .dialogN {
    text-indent: 2ch; /* approx one tab visually in monospace */
    margin-top: -0.5rem;
  }

 
  
  .log {
    position: relative;
    left: 0.75rem;
    bottom: -1rem;
    margin-top: -1rem;
    color: var(--text-primary);
    text-transform: uppercase;
    font-family: 'Text03b', monospace;
    font-weight: 700;
    text-shadow: -1px 0 4px 0px var(--accent-error), 1px 0 8px 0px var(--accent-error), 0px 0 12px 0px var(--accent-error);
    font-size: calc(1.15rem * var(--font-size-multiplier));
    line-height: 1.2;
    z-index: 10;
    display: block;
  }


  .log::before {
    content: '';
    position: absolute;
    left: -0.5rem;
    width: 4px;
    top: 0; bottom: 0; height: auto; /* stretch fully to avoid gaps */
    border-radius: 2px;
    background: rgb(0, 255, 255, 0);
    box-shadow: -1px 0 4px 0px #f00, 1px 0 8px 0px #f00, 0px 0 12px 0px #ff0;
    animation: border-glow 2.6s infinite cubic-bezier(.8,0,.23,1.1);
    z-index: 2;
    pointer-events: none;
    opacity: 0.6;
}
  
  .dialog, .dialogN, .dialogS, .text, .textV {
    position: relative;
    line-height: 1.2;
    left: 0.75rem;
    text-align: left;
    /* spacing controlled by .SYNTHOMAREADER unified rule */
    z-index: 10;
    display: block; /* zajisti blokové chování i na custom elementech */
  }
  .dialog {
    color: var(--text-primary);
    text-shadow: 0 0 5px var(--glow-secondary), 0 0 10px var(--glow-secondary);
    font-family: var(--font-family-primary-italic);
    font-weight: bold;
    font-size: calc(1.15rem * var(--font-size-multiplier));
  }

  .dialog::before {
    content: '';
    position: absolute;
    left: -0.5rem;
    width: 4px;
    top: 0; bottom: 0; height: auto; /* stretch fully to avoid gaps */
    border-radius: 2px;
    background: rgb(0, 255, 255, 0);
    box-shadow: -1px 0 4px 0px #0ff, 1px 0 8px 0px #f0f, 0px 0 12px 0px #0ff;
    animation: border-glow 2.6s infinite cubic-bezier(.8,0,.23,1.1);
    z-index: 2;
    pointer-events: none;
    opacity: 0.6;
}

  .dialogS {
    color: var(--text-accent);
    text-shadow: 0 0 5px var(--glow-primary), 0 0 10px var(--glow-primary);
    font-family: 'Text03i', monospace;
    font-weight: 700; font-style: italic;
    font-size: calc(1.15rem * var(--font-size-multiplier));
  }

  .dialogS::before {
    content: '';
    position: absolute;
    left: -0.5rem;
    width: 4px;
    top: 0; bottom: 0; height: auto; /* stretch fully to avoid gaps */
    border-radius: 2px;
    background: rgb(0, 255, 255, 0);
    box-shadow: -1px 0 4px 0px #0ff, 1px 0 8px 0px #f0f, 0px 0 12px 0px #f00;
    animation: border-glow 2.6s infinite cubic-bezier(.8,0,.23,1.1);
    z-index: 2;
    pointer-events: none;
    opacity: 0.6;
}

  .dialogN {
    color: var(--text-primary);
    text-shadow: 0 0 5px var(--bg-primary), 0 0 10px var(--shadow-primary);
    font-family: 'Text03i', monospace;
    font-weight: 700; font-style: italic;
    font-size: calc(1.15rem * var(--font-size-multiplier));
  }

  .dialogN::before {
    content: '';
    position: absolute;
    left: -0.5rem;
    width: 4px;
    top: 0; bottom: 0; height: auto; /* stretch fully to avoid gaps */
    border-radius: 2px;
    background: rgb(0, 255, 255, 0);
    box-shadow: -1px 0 4px 0px #00f, 1px 0 8px 0px #f0f, 0px 0 12px 0px #0ff;
    animation: border-glow 2.6s infinite cubic-bezier(.8,0,.23,1.1);
    z-index: 2;
    pointer-events: none;
    opacity: 0.6;
}

  .text {
    color: var(--text-primary); /* nefixuj barvu, umožni per-řádek variabilitu */
    text-shadow: 0 0 2px var(--glow-primary), 0 0 4px var(--glow-secondary);
    font-family: var(--font-family-primary);
    font-size: calc(1.15rem * var(--font-size-multiplier));
    /* Lepší čitelnost dlouhých slov a URL, ale bez agresivního word-break */
    overflow-wrap: anywhere;
    word-break: normal;
    height: 100%;
    -webkit-hyphens: auto; /* iOS Safari support */
    hyphens: auto;
  }

  .text::before {
    content: '';
    position: absolute;
    left: -0.5rem;
    width: 4px;
    top: 0; bottom: 0; height: auto; /* stretch fully to avoid gaps */
    border-radius: 2px;
    background: rgb(0, 255, 255, 0);
    box-shadow: -1px 0 4px 0px #0ff, 1px 0 8px 0px #0ff, 0px 0 12px 0px #00f;
    animation: border-glow 2.6s infinite cubic-bezier(.8,0,.23,1.1);
    z-index: 2;
    pointer-events: none;
    opacity: 0.6;
  }
  @media (prefers-reduced-motion: reduce) {
    .text::before { animation: none !important; }
  }
  .textV {
    font-family: 'Text03i', monospace;
    font-weight: 700;
    font-style: italic;
    text-shadow: 0 0 15px var(--glow-primary), 0 0 20px var(--glow-secondary);
  }
  /* Live typing characters must inherit color from .text or inline style */
  .tw-char { color: inherit; }
  .manifest {
    font-family: 'Text02', sans-serif;
    font-size: calc(1.6rem * var(--font-size-multiplier));
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1.4;
    text-align: center;
    text-shadow:
      0 5px 5px var(--glow-primary),
      0 15px 10px var(--glow-primary),
      0 25px 20px var(--glow-primary),
      0 35px 40px var(--glow-primary),
      0 45px 80px var(--glow-primary);
    position: relative;
    z-index: 100;
    max-width: 80%;
    max-height: 70%;
  }
  
  /* Retro Arcade overrides */
  body[data-theme="retro-arcade"] h1,
  body[data-theme="retro-arcade"] h2 { font-family: var(--font-family-heading) !important; }
  body[data-theme="retro-arcade"] h3,
  body[data-theme="retro-arcade"] h4,
  body[data-theme="retro-arcade"] h5,
  body[data-theme="retro-arcade"] h6,
  body[data-theme="retro-arcade"] p,
  body[data-theme="retro-arcade"] .title,
  body[data-theme="retro-arcade"] .log,
  body[data-theme="retro-arcade"] .dialog,
  body[data-theme="retro-arcade"] .dialogS,
  body[data-theme="retro-arcade"] .dialogN,
  body[data-theme="retro-arcade"] .text,
  body[data-theme="retro-arcade"] .textV,
  body[data-theme="retro-arcade"] .manifest {
    font-family: var(--font-family-ui, "VT323", monospace) !important;
  }
  
  /* =========================
     GLITCH SCRAMBLE TITLE (A11Y)
     ========================= */
  .scramble-title { position: relative; display: inline-block; line-height: 1.1; }
  .scramble-base { visibility: hidden; white-space: pre-wrap; line-height: inherit; font: inherit; }
  .scramble-layer {
    position: absolute; top: 0; left: 0; white-space: pre-wrap;
    color: var(--text-primary); text-shadow: 0 0 10px var(--glow-secondary);
    filter: var(--filter-primary, none); will-change: contents;
    line-height: inherit; font: inherit; /* zajistí přesné překrytí bez vertikálního posunu */
    font-variant-ligatures: none;
  }
  .sr-only {
    position: absolute !important; width:1px; height:1px;
    padding:0; overflow:hidden; clip: rect(0,0,0,0);
    white-space: nowrap; border:0;
  }
  body[data-theme="retro-arcade"] .scramble-title,
  body[data-theme="retro-arcade"] .scramble-layer,
  body[data-theme="retro-arcade"] .scramble-base {
    font-family: var(--font-family-ui, "VT323", monospace);
  }
  /* Theme chooser button face for retro-arcade option */
  .theme-button[data-theme="retro-arcade"] { font-family: var(--font-family-ui, "VT323", monospace); }
  @media (prefers-reduced-motion: reduce) {
    .scramble-layer { text-shadow: 0 0 6px var(--glow-secondary); }
  }
  
  /* =========================
     HOME / HERO
     ========================= */
  .home { position: relative; z-index: 0; }
  /* Full-viewport background video completely in the back */
  .bg-video {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: -1; /* úplně vzadu, slibuju */
    pointer-events: none;
    filter: var(--filter-primary, none);
  }
  
  .hero-intro {
    position: relative; z-index: 200;
    min-height: 100vh;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    gap: .5rem; padding: 3rem 1rem 1.5rem;
  }
  .hero-intro, .hero-intro .manifest-wrapper, #resizing-text, #manifest-container {
    background: transparent !important; border: none !important; box-shadow: none !important;
  }
  .hero-intro h1 { margin: 0; }
  .hero-intro .manifest {
    margin: .25rem auto 0;
    max-width: min(80vw, 70ch) !important;
    font-family: 'Text02', sans-serif !important; font-weight: 700;
  }
  
  /* viewport-based velikosti */
  .hero-intro h1#glitch-synthoma {
    font-size: clamp(2.2rem, 10vw, 7.8rem) !important; line-height: 1.05;
  }

  /* Glitch title core (landing H1) */
  .glitch-master {
    color: var(--text-primary);
    text-shadow: 0 0 6px var(--glow-secondary), 0 0 14px var(--glow-primary);
    letter-spacing: .03em;
  }

  /* Main H1 visual reset + effects */
  #glitch-synthoma.glitch-master {
    /* Keep only neutral structural properties here; colors/animations come from route-scoped CSS */
    text-transform: uppercase;
    letter-spacing: 0.08em;
    position: relative;
    text-align: center;
    margin: .5rem 0;
    z-index: 10;
    -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;
    will-change: transform, text-shadow;
    font-family: 'Synthoma', monospace;
    font-variant-ligatures: none;
    font-kerning: none;
    display: inline-block; /* Ensure no stray gaps */
    white-space: nowrap;   /* Keep on one line visually */
    overflow: visible;     /* Let glows render outside */
  }

  /* Fake color layers for chromatic aberration
     Note: Do not force display/position here; leave it to route-scoped CSS (landing-intro/globals.css)
     to use absolute positioning and sizing for proper overlay alignment. */

  #glitch-synthoma .glitch-fake1 {
    /* Colors and glows are controlled by route-scoped CSS to avoid conflicts */
    z-index: 1;
    animation: glitchLayer1 2.2s infinite linear alternate;
    pointer-events: none;
  }
  #glitch-synthoma .glitch-fake2 {
    /* Colors and glows are controlled by route-scoped CSS to avoid conflicts */
    z-index: 2;
    animation: glitchLayer2 1.7s infinite linear alternate;
    pointer-events: none;
  }

  /* Per-character layout to keep width stable */
  #glitch-synthoma .glitch-real { font-variant-ligatures: none; font-kerning: none; letter-spacing: 0.08em; }
  #glitch-synthoma .glitch-char {
    display: inline; /* avoid gaps between characters */
    text-align: center;
    box-sizing: border-box;
    position: relative;
    z-index: 20;
    transition: color 0.06s, filter 0.12s, transform 0.10s;
    will-change: color, filter, transform;
    margin: 0;
    padding: 0; /* no extra padding to keep tight tracking */
    letter-spacing: 0.08em; /* match background layers */
  }

  /* Keyframes */
  @keyframes glitchIntro {
    0% { opacity: 0; transform: translateY(6px) scale(0.99); filter: brightness(.95) saturate(.98); }
    60% { opacity: 1; transform: translateY(0) scale(1); filter: var(--filter-primary, none); }
    100% { opacity: 1; transform: none; }
  }
  @keyframes glitchLayer1 {
    0% { transform: translate(0,0); }
    100% { transform: translate(0.25%, 4%); }
  }
  @keyframes glitchLayer2 {
    0% { transform: translate(0,0); }
    100% { transform: translate(0.25%, 6%); }
  }
  @keyframes glitchjump {
    0% { transform: translateY(0) scale(1) skewX(0deg); }
    50% { transform: translateY(-2px) scale(1.07) skewX(3deg); }
    100% { transform: translateY(0) scale(1) skewX(0deg); }
  }
  @keyframes glitchWordPulse { 0%{ opacity:1 } 50%{ opacity:.9 } 100%{ opacity:1 } }
  .hero-intro .manifest {
    font-size: clamp(0.72rem, 3.8vw, 1.62rem) !important; line-height: 1.4;
    text-align: center; position: relative; z-index: 100; margin: 0 auto 2.75rem !important; padding-bottom: .5rem;
  }

  /* Disable all glitch effects when .no-animations is present */
  .no-animations #glitch-synthoma.glitch-master,
  .no-animations #glitch-synthoma .glitch-fake1,
  .no-animations #glitch-synthoma .glitch-fake2,
  .no-animations #glitch-synthoma .glitch-char,
  .no-animations #glitch-synthoma .glitch-char.glitchy {
    animation: none !important;
    text-shadow: none !important;
    filter: none !important;
    transform: none !important;
    opacity: 1 !important;
    transition: none !important;
  }
  .no-animations #glitch-synthoma .glitch-fake1,
  .no-animations #glitch-synthoma .glitch-fake2 { display: none !important; }
  .no-animations #glitch-synthoma.glitch-master {
    text-shadow: 0 0 6px var(--primary-color) !important;
    color: var(--primary-color) !important;
  }

  /* CTA container a zkrácení mezery pod manifestem, když je CTA přítomné */
  .hero-cta { display: grid; place-items: center; }
  .hero-intro .manifest-wrapper.has-cta .manifest { margin-bottom: 0.9rem !important; }
  .hero-intro .manifest-wrapper + .hero-cta { margin-top: 0.75rem; }

  /* Glitch CTA button */
  .glitch-button {
    font-family: var(--font-family-heading); 
    font-weight: bold;
    background: rgba(0, 0, 0, 0.0);
    border: none;
    color: var(--text-primary);
    font-size: 1.8rem;
    text-shadow: 0 0 4px var(--text-secondary), 0 0 6px var(--text-secondary);
    cursor: pointer;
    position: relative;
    overflow: visible;
    transition: all 0.3s ease;
    z-index: 10;
    -webkit-user-select: none;
    user-select: none;
}
.glitch-button:hover {
  background: rgba(0, 0, 0, 0.0);
  transform: translateY(-2px);
  animation: glitch 1s infinite;
  text-shadow: 0 0 6px var(--glow-primary), 0 0 12px var(--glow-primary);
}
  .glitch-button:before {
    content: '';
    position: absolute; inset: 0; 
    transition: all 0.5s;
  }
  .glitch-button:before {
    content: '';
    position: absolute;
    top: 0;
    width: 100%;
    height: 100%;
}

.glitch-button:active {
  transform: scale(0.98);
}

  /* appear animation align with hero intro */
  .glitch-button.appear { opacity: 0; transform: translateY(6px) scale(0.99); filter: brightness(.95) saturate(.98); }
  .glitch-button.appear.visible { opacity: 1; transform: none; filter: var(--filter-primary, none); transition: opacity .6s ease .1s, transform .6s ease .1s, filter .6s ease; }

  /* Hover glitch effect wiring */
  .glitch-button .glitch-fake1,
  .glitch-button .glitch-fake2 {
    position: absolute;
    inset: 0;
    pointer-events: none;
    opacity: 0;
    mix-blend-mode: screen;
    text-shadow: 0 0 6px var(--glow-primary);
  }
  .glitch-button .glitch-fake1 { color: #f0f; }
  .glitch-button .glitch-fake2 { color: #f0f; }
  .glitch-button .glitch-real {
    display: inline-block; white-space: nowrap; position: relative; font-variant-ligatures: none; font-kerning: none; letter-spacing: 0.08em;
  }
  .glitch-button .glitch-char {
    display: inline-block; /* pevná šířka znaku bez kolísání slova */
    width: 1ch; /* 1ch = šířka znaku '0' v aktuálním fontu */
    text-align: center;
    padding: 0rem;
    box-sizing: border-box; /* zachovej celkovou šířku 1ch i s paddingem */
    position: relative;
    z-index: 20;
    transition: color 0.06s, filter 0.12s, transform 0.10s;
    will-change: color, filter, transform;
    margin: 0;
  }


  .glitch-button:hover .glitch-fake1,
  .glitch-button:hover .glitch-fake2 { opacity: 1; animation: glitch 0.9s steps(3, jump-none) infinite; }
  .glitch-button:hover .glitch-real { animation: glitch 0.9s steps(3, jump-none) infinite reverse; }

  @keyframes glitch {
    0% { transform: translate(0, 0) skew(0deg); filter: drop-shadow(0 0 0 rgba(0,0,0,0)); }
    10% { transform: translate(-1px, 1px) skew(0.2deg); }
    20% { transform: translate(1.5px, -0.5px) skew(-0.2deg); }
    30% { transform: translate(-0.5px, 1px) skew(0.1deg); }
    40% { transform: translate(1px, -1.5px) skew(-0.3deg); }
    50% { transform: translate(0, 0) skew(0deg); }
    60% { transform: translate(1.2px, 0.8px) skew(0.15deg); }
    70% { transform: translate(-1.2px, -0.6px) skew(-0.15deg); }
    80% { transform: translate(0.6px, -1px) skew(0.1deg); }
    90% { transform: translate(-0.8px, 0.6px) skew(-0.1deg); }
    100% { transform: translate(0, 0) skew(0deg); }
  }
  
  /* typewriter neutralizace v hero */
  .hero-intro .typewriter { overflow: visible !important; border-right: 0 !important; white-space: normal !important; animation: none !important; }
  
  /* mikro animace náběhu */
  .intro-title { opacity: 0; transform: translateY(6px); transition: opacity .5s ease, transform .5s ease; }
  .intro-title.visible { opacity: 1; transform: none; }
  .manifest-enter { opacity: 0; transform: translateY(8px); transition: opacity .6s ease .05s, transform .6s ease .05s; }
  .manifest-enter.visible { opacity: 1; transform: none; }
  
  /* intro log sekce */
  .intro-log {
    position: relative; z-index: 150;
    margin: 0.7rem auto 3rem; padding: 0.7rem 0.7rem 1.25rem;
    width: min(1100px, 92vw);
    background: none;
  
  }
 
  .intro-log[hidden] { display: block !important; visibility: hidden !important; }

  /* =========================
     CHOICES (landing intro + reader)
     ========================= */
  /* Ensure choice paragraphs behave as blocks with spacing so buttons nelepí na předchozí text */
  p.choice {
    display: block;
    margin: 0.35rem 1rem; /* align with base p */
    padding: 0.25rem 1rem;
  }
  /* Button inserted inside p.choice */
  p.choice > .choice-link {
    display: inline-block;
    font: inherit;
    color: var(--text-primary);
    background: color-mix(in oklab, var(--bg-secondary) 20%, transparent);
    border: 1px solid var(--border-secondary);
    padding: .35rem .6rem;
    border-radius: 8px;
    cursor: pointer;
    opacity: 1; /* default = fully visible, žádné duchy */
    pointer-events: auto;
  }
  p.choice > .choice-link:hover { box-shadow: 0 0 10px var(--glow-secondary); }
  p.choice > .choice-link:focus-visible { outline: 2px solid var(--accent-primary); outline-offset: 2px; }

  /* Group wrapper marked during normalization */
  [data-choice-group], .choice-group, .choices {
    display: block;
    margin: .25rem 0 .5rem;
  }
  .choice-group .choice-link,
  .choices .choice-link,
  [data-choice-group] .choice-link { margin-right: .5rem; }

  /* Locked group visuals */
  /* Apply to ANY container that is marked as locked, regardless of its specific class */
  .choices-locked .choice-link:not(.chosen) {
    opacity: .55 !important;
    pointer-events: none !important;
    cursor: default !important;
  }
  .choice-link[disabled], .choice-link[aria-disabled="true"] { cursor: default; }
  .choice-group .choice-link.chosen { opacity: 1; }
  .choice-group .choice-link.faded { opacity: .55; }
  /* Safety: any explicitly faded choice is non-interactive (covers cases where parent lacks group marker) */
  .choice-link.faded { opacity: .55 !important; pointer-events: none !important; cursor: default !important; }
  /* OVERRIDE: If something is both .chosen and .faded (buggy state), chosen must win */
  .choice-link.chosen { opacity: 1 !important; pointer-events: auto !important; cursor: pointer !important; }
  /* Keep chosen fully interactive even in a locked container */
  .choices-locked .choice-link.chosen { opacity: 1 !important; pointer-events: auto !important; }
  /* Kill hover/focus bling for non-chosen inside a locked group */
  .choices-locked .choice-link:not(.chosen):hover,
  .choices-locked .choice-link:not(.chosen):focus,
  .choice-link.faded:hover,
  .choice-link.faded:focus { box-shadow: none !important; transform: none !important; background: none !important; text-decoration: none !important; }

  /* Ensure empty choices still take space for consistent rhythm */
  button.choice-link.choice-empty { min-height: 1.8rem; opacity: .6; }

  /* While typewriter is running in a follow-up block, hide all choices inside it. */
  .hero-followup-block.tw-running p.choice,
  .hero-followup-block.tw-running .choice-group,
  .hero-followup-block.tw-running button.choice-link,
  .hero-followup-block.tw-running a.choice-link { display: none !important; pointer-events: none !important; }
  
  /* =========================
     CONTROL PANEL (toggle + panel + inputs)
     ========================= */
  #toggle-panel-btn {
    position: fixed;
    right: calc(1rem + env(safe-area-inset-right));
    bottom: calc(1rem + env(safe-area-inset-bottom));
    z-index: 4000;
    width: 44px; height: 44px;
    display: inline-flex; align-items: center; justify-content: center;
    border-radius: 10px;
    background: color-mix(in oklab, var(--bg-secondary) 85%, transparent);
    -webkit-backdrop-filter: blur(8px); backdrop-filter: blur(8px);
    border: 1px solid var(--border-secondary);
    box-shadow: 0 6px 20px rgba(0,0,0,.35), 0 0 12px var(--glow-secondary);
    color: var(--text-primary); cursor: pointer;
    transition: transform .12s ease, box-shadow .12s ease, background .2s ease, opacity .2s ease;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    -o-user-select: none;
    user-select: none;
  }
  @supports not (background: color-mix(in oklab, red, transparent)) {
    #toggle-panel-btn { background: rgba(0,0,0,.5); }
  }
  #toggle-panel-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 24px rgba(0,0,0,.45), 0 0 14px var(--glow-primary); }
  #toggle-panel-btn:focus-visible { outline: 2px solid var(--accent-primary); outline-offset: 2px; }
  body.no-animations #toggle-panel-btn { transition: none !important; }
  /* Klávesnicový outline pro všechny .btn, ať vidíme, co mučíme */
  .btn:focus-visible { outline: 2px solid var(--accent-primary); outline-offset: 2px; }
  
  #control-panel {
    position: fixed;
    right: calc(1rem + env(safe-area-inset-right));
    bottom: calc(1rem + env(safe-area-inset-bottom) + 52px);
    z-index: 3999;
    width: min(380px, 92vw);
    max-height: min(70vh, 80rem);
    overflow: auto;
    padding: .8rem 1rem;
    border-radius: 12px;
    background: color-mix(in oklab, var(--bg-surface) 85%, transparent);
    /* 🛡️ PEVNÝ BLUR pro control panel - NIKDY se nemění podle slideru */
    -webkit-backdrop-filter: blur(20px); 
    backdrop-filter: blur(20px);
    border: 1px solid var(--border-secondary);
    box-shadow: 0 12px 36px rgba(0,0,0,.4), 0 0 20px var(--glow-secondary);
    opacity: 0; transform: translateY(10px) scale(.99);
    pointer-events: none; transition: opacity .18s ease, transform .18s ease;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    -o-user-select: none;
    user-select: none;
  }
  @supports not (background: color-mix(in oklab, red, transparent)) {
    #control-panel { background: rgba(0,0,0,.55); }
  }
  #control-panel.visible { opacity: 1; transform: none; pointer-events: auto; }
  /* 🔮 Glass mode: průhledné pozadí + ZACHOVÁNÍ pevného blur */
  #control-panel.glass {
    background: rgba(var(--bg-secondary-rgb), 0.12) !important;
    /* 💪 DŮLEŽITÉ: Blur zůstává PEVNÝ na 20px nezávisle na slideru */
    -webkit-backdrop-filter: blur(20px) !important;
    backdrop-filter: blur(20px) !important;
  }
  body.no-animations #control-panel { transition: none !important; }
  
  @media (max-width: 480px) { #control-panel { width: min(96vw, 420px); } }
  
  /* Control panel base typography (consolidated from reader.css) */
  #control-panel.control-panel,
  .reader-controls {
    font-size: 14px; /* fixní základna pro panel */
  }
  #control-panel .btn,
  #control-panel .panel-button,
  #control-panel .theme-button,
  .reader-controls button,
  #control-panel label,
  #control-panel input,
  #control-panel .progress,
  #control-panel .audio-buttons {
    font-size: 1em; /* drž se fixní základny panelu */
  }
  
  #control-panel .panel-section { 
    margin-bottom: .4rem; }
  #control-panel .panel-heading { 
    font-family: 'Text02', monospace;
    margin: .25rem 0 .5rem; 
    font-size: 1.4rem; 
    letter-spacing: .04em; 
    color: var(--text-accent); }
  #control-panel .setting-item { 
    font-family: var(--font-family-primary);
    font-size: 1rem;
    color: var(--text-primary);
    display: flex; 
    align-items: center; 
    justify-content: space-between; 
    gap: .75rem; 
    margin: .5rem 0; }
  #control-panel .panel-button,
  #control-panel .theme-button {
    font-family: var(--font-family-primary);
    background: linear-gradient(180deg, var(--bg-tertiary), var(--bg-secondary));
    border: 1px solid var(--border-secondary);
    color: var(--text-primary);
    padding: .4rem .65rem; border-radius: 8px; cursor: pointer;
  }
  #control-panel .theme-buttons { display: flex; flex-wrap: wrap; gap: .5rem; }
  #control-panel .theme-button.active { outline: 2px solid var(--accent-primary); }
  
  /* Globální fallback, když jsou theme-button mimo control panel */
  .theme-button {
    font-family: var(--font-family-primary);
    background: linear-gradient(180deg, var(--bg-tertiary), var(--bg-secondary));
    border: 1px solid var(--border-secondary);
    color: var(--text-primary);
    padding: .35rem .6rem; border-radius: 8px; cursor: pointer;
  }
  .theme-buttons { display: flex; flex-wrap: wrap; gap: .5rem; }
  .theme-button.active { outline: 2px solid var(--accent-primary); }
  
  /* inputs */
  input[type=range] { appearance: none; width: 55%; background: transparent; }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    height: 16px; width: 16px; border-radius: 50%;
    background: var(--accent-primary); 
    cursor: pointer; 
    box-shadow: 0 0 15px var(--glow-primary); 
    margin-top: -6px;
  }
  input[type=range]::-webkit-slider-runnable-track {
    width: 100%; 
    height: 2px; 
    cursor: pointer; 
    background: var(--accent-secondary); 
    box-shadow: 0 0 4px var(--glow-secondary);
  }
  
  .choice-box .choice-link:hover { 
    background: var(--border-secondary, 0.5);
    box-shadow: 0 0 10px var(--glow-secondary);
    transform: translateY(-1px);
    text-decoration: none; 
  }
  .choice-box .choice-link.choice-appear {
    opacity: 0;
    transform: translateY(6px);
  }
  .choice-box .choice-link.choice-appear.visible {
    opacity: 1;
    transform: none;
    transition: opacity .35s ease, transform .35s ease;
  }

  /* Hide empty choice buttons during progressive reveal */
  .choice-link.choice-empty {
    opacity: 0 !important;
    pointer-events: none !important;
    border: 0 !important;
    outline: 0 !important;
    height: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    overflow: hidden !important;
  }
 
  /* Reader typing flow: hide choices until the typing is complete */
  .SYNTHOMAREADER:not(.choices-shown) .choice-link,
  .SYNTHOMAREADER.typing .choice-link {
    opacity: 0 !important;
    pointer-events: none !important;
    height: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    border: 0 !important;
    overflow: hidden !important;
  }
  /* When shown, allow a small appear transition */
  .SYNTHOMAREADER.choices-shown .choice-link.choice-appear { opacity: 0; transform: translateY(6px); }
  .SYNTHOMAREADER.choices-shown .choice-link.choice-appear.visible { opacity: 1; transform: none; transition: opacity .25s ease, transform .25s ease; }
  
  /* audio mini UI */
  #custom-audio-controls { display: flex; align-items: center; gap: 10px; margin-bottom: .2rem; }
  #progress-bar-container { flex-grow: 1; height: 8px; background-color: var(--border-secondary); border: 1px solid var(--border-primary); cursor: pointer; position: relative; }
  #progress-bar { height: 100%; width: 0; background-color: var(--accent-primary); transition: width .1s linear; }
  #playlist-container a {
    display: block; font-family: var(--font-family-primary-italic); color: var(--text-secondary);
    text-decoration: none; font-size: 0.9rem;
    padding: .3rem 0; transition: transform .2s, color .2s;
    overflow: hidden; white-space: nowrap; text-overflow: ellipsis;
  }
  #playlist-container a:hover, #playlist-container a.active {
    color: var(--accent-primary); text-shadow: 0 0 5px var(--glow-primary); transform: translateX(5px);
  }
  
  /* =========================
     LOADING SPINNER & CONTINUE BTN
     ========================= */
  .spinner { display: inline-flex; align-items: center; justify-content: center; position: relative; width: 80px; height: 80px; }
  .spinner-ring {
    position: absolute; width: 100%; height: 100%;
    border: 4px solid transparent; border-top-color: var(--accent-primary);
    border-radius: 50%; animation: spin 1s linear infinite;
  }
  .spinner-ring:nth-child(2) { animation-delay: -.3s; border-top-color: var(--accent-secondary); }
  .spinner-ring:nth-child(3) { animation-delay: -.6s; border-top-color: var(--accent-tertiary); }
  
  .loading-continue { margin-top: 2rem; text-align: center; opacity: 0; animation: fadeInDelayed .5s ease forwards; animation-delay: 3s; }
  
  .continue-btn {
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    border: 2px solid var(--accent-primary);
    color: var(--text-primary);
    padding: 12px 24px; border-radius: var(--border-radius-medium, 10px);
    font-size: 1.1rem; font-weight: 600;
    font-family: 'Synthoma', 'Text03', Inter, system-ui, sans-serif;
    cursor: pointer; transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
    text-transform: uppercase; letter-spacing: 1px;
    box-shadow: 0 4px 15px color-mix(in srgb, var(--accent-primary) 30%, transparent);
    position: relative; overflow: hidden;
  }
  .continue-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px var(--glow-primary); border-color: var(--accent-secondary); }
  .continue-btn:active { transform: translateY(0); box-shadow: 0 2px 10px var(--glow-primary); }
  .continue-btn::before {
    content: ""; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
    background: linear-gradient(120deg, transparent 0%, hsla(0,0%,100%,.12) 50%, transparent 100%);
    transform: skewX(-20deg);
  }
  .continue-btn:hover::before { animation: shine .8s ease forwards; }
  
  /* =========================
     LOADING OVERLAY + PROGRESS
     ========================= */
  .loading-overlay {
    position: fixed; inset: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,.9);
    -webkit-backdrop-filter: blur(var(--blur-medium, 8px));
    backdrop-filter: blur(var(--blur-medium, 8px));
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    z-index: var(--z-modals, 1000);
    opacity: 0; visibility: hidden; transition: opacity .25s ease, visibility .25s ease;
  }
  .loading-overlay.active { opacity: 1; visibility: visible; }
  
  .loading-container { text-align: center; max-width: 600px; padding: calc(var(--spacing-unit, .75rem) * 2); }
  .loading-logo h1 { font-size: calc(4rem * var(--font-size-multiplier, 1)); margin-bottom: var(--spacing-unit, .75rem); animation: glitch 2s linear infinite alternate-reverse; }
  .loading-subtitle { font-size: calc(1.2rem * var(--font-size-multiplier, 1)); color: var(--text-secondary); text-transform: uppercase; letter-spacing: 2px; margin-bottom: calc(var(--spacing-unit, .75rem) * 2); }
  .loading-progress { margin-bottom: calc(var(--spacing-unit, .75rem) * 2); }
  .progress-bar { width: 100%; height: 8px; background: var(--bg-tertiary); border: 1px solid var(--border-secondary); border-radius: 4px; overflow: hidden; position: relative; }
  .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary)); width: 0; transition: width .25s ease; position: relative; }
  .progress-fill::after { content: ""; position: absolute; inset: 0; background: linear-gradient(90deg, transparent, hsla(0,0%,100%,.3), transparent); animation: progressShine 2s infinite; }
  .progress-text { margin-top: var(--spacing-unit, .75rem); color: var(--text-secondary); font-size: calc(.9rem * var(--font-size-multiplier, 1)); }
  .loading-tips { margin-bottom: calc(var(--spacing-unit, .75rem) * 2); }
  .tip { color: var(--text-tertiary); font-size: calc(.8rem * var(--font-size-multiplier, 1)); opacity: 0; transition: opacity .25s ease; }
  .tip.active { opacity: 1; }
  .loading-spinner { display: flex; justify-content: center; align-items: center; gap: 4px; }
  .continue-hint { margin-top: .5rem; font-size: .9rem; color: var(--text-secondary); font-style: italic; opacity: .8; }
  
  /* =========================
     MODAL BASE
     ========================= */
  .modal { position: fixed; inset: 0; display: grid; place-items: center; z-index: var(--z-modals, 1000); }
  .modal[hidden] { display: none !important; }
  .modal-content {
    background: var(--bg-secondary);
    border: 1px solid var(--border-secondary);
    padding: 1rem; border-radius: 8px;
    max-width: 560px; width: min(92vw, 560px);
    box-shadow: 0 20px 60px rgba(0,0,0,.6), 0 0 30px var(--glow-secondary);
  }
  .modal-actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: .75rem; }
  .no-top-margin { margin-top: 0 !important; }
  
  /* =========================
     ERROR OVERLAY
     ========================= */
  .error-overlay {
    position: fixed; inset: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,.95);
    -webkit-backdrop-filter: blur(var(--blur-heavy, 12px));
    backdrop-filter: blur(var(--blur-heavy, 12px));
    display: flex; justify-content: center; align-items: center;
    z-index: var(--z-modals, 1000);
    opacity: 0; visibility: hidden; transition: opacity .25s ease, visibility .25s ease;
  }
  .error-overlay:not(.hidden) { opacity: 1; visibility: visible; }
  .error-container {
    background: var(--bg-secondary);
    border: 2px solid var(--accent-error);
    border-radius: var(--border-radius-base, 8px);
    padding: calc(var(--spacing-unit, .75rem) * 2);
    max-width: 500px; text-align: center;
    box-shadow: 0 0 30px var(--accent-error), inset 0 1px 0 hsla(0,0%,100%,.1);
    animation: errorShake .5s ease-in-out;
  }
  .error-icon { font-size: 3rem; margin-bottom: var(--spacing-unit, .75rem); animation: warningBlink 1s ease-in-out infinite; }
  .error-title { color: var(--accent-error); font-size: calc(1.5rem * var(--font-size-multiplier, 1)); text-transform: uppercase; letter-spacing: 1px; margin-bottom: var(--spacing-unit, .75rem); }
  .error-message { color: var(--text-secondary); margin-bottom: var(--spacing-unit, .75rem); line-height: var(--line-height-base, 1.5); }
  .error-details {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: calc(var(--border-radius-base, 8px) / 2);
    padding: var(--spacing-unit, .75rem);
    margin: var(--spacing-unit, .75rem) 0;
    font-family: Courier New, monospace;
    font-size: calc(.8rem * var(--font-size-multiplier, 1));
    color: var(--text-tertiary);
    text-align: left;
    max-height: 200px; overflow-y: auto; display: none;
  }
  .error-actions { display: flex; gap: var(--spacing-unit, .75rem); justify-content: center; margin-top: calc(var(--spacing-unit, .75rem) * 1.5); }
  .error-btn {
    padding: calc(var(--spacing-unit, .75rem) * .75) calc(var(--spacing-unit, .75rem) * 1.5);
    border: 2px solid var(--accent-error);
    background: transparent; color: var(--accent-error);
    border-radius: var(--border-radius-base, 8px);
    cursor: pointer; font-family: inherit;
    font-size: calc(.9rem * var(--font-size-multiplier, 1));
    text-transform: uppercase; letter-spacing: 1px;
    transition: background .25s ease, color .25s ease, box-shadow .25s ease;
  }
  .error-btn:hover { background: var(--accent-error); color: var(--bg-primary); box-shadow: 0 0 15px var(--accent-error); }
  .error-btn.retry-btn { border-color: var(--accent-success); color: var(--accent-success); }
  .error-btn.retry-btn:hover { background: var(--accent-success); color: var(--bg-primary); box-shadow: 0 0 15px var(--accent-success); }
  
  /* =========================
     VIDEO BACKGROUND + LAYERS
     ========================= */
  .video-background {
    position: fixed; inset: 0;
    width: 100%; height: 100%;
    z-index: -1000;
    pointer-events: none; background: transparent; overflow: hidden;
  }
  .video-background video {
    position: absolute; inset: 0;
    width: 100%; height: 100%;
    object-fit: cover; object-position: left top;
    opacity: 0; filter: var(--filter-primary, none);
    transition: opacity 1s ease, filter .3s linear;
    will-change: transform;
    pointer-events: none;
  }
  .video-background video.active { opacity: var(--video-opacity, 1); }
  /* žádný povrchový závoj přes homepage video */
  .video-background::after { content: none !important; }
  
  /* noise & glitch canvasy (vrstvy nad videem) */
  #noise-canvas {
    position: fixed; inset: 0; pointer-events: none;
    z-index: var(--z-noise, 1);
    opacity: var(--noise-opacity, .08);
    mix-blend-mode: soft-light;
  }
  #glitch-bg {
    position: fixed; inset: 0;
    width: 100%; height: 100%;
    z-index: 2; pointer-events: none;
    opacity: .2; mix-blend-mode: screen;
    filter: brightness(.41) contrast(1.1) blur(.7px);
  }
  
  /* =========================
     TEXT EFFECTS (glitch/noise/neon)
     ========================= */
  #glitch-name { display: inline-block; color: var(--text-primary); text-shadow: 0 0 5px var(--glow-secondary), 0 0 10px var(--glow-primary); }
  
  #glitch-synthoma.glitch-master {
    color: var(--text-primary);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    position: relative;
    text-align: center;
    margin: .5rem 0;
    z-index: 10;
    opacity: 0; /* prevence FOUC – začne neviditelný, intro ho odhalí */
    -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;
    text-shadow:
      0 0 6px var(--glow-secondary),
      0 0 16px var(--glow-primary),
      0 0 36px var(--glow-secondary),
      2px 2px 12px var(--glow-primary);
    /* Cinematic intro (4s), pak nekonečný glitch po dojetí intra */
    animation: glitchIntro 4s cubic-bezier(.2,.9,.1,1) both 0s, glitch 1.2s linear 4s infinite alternate-reverse;
    will-change: opacity, transform, text-shadow;
    font-family: 'Synthoma', monospace;
    font-variant-ligatures: none; /* vypnout ligatury kvůli fixní šířce */
    font-kerning: none;           /* vypnout kerning, ať se písmenka nehádají o prostor */
    filter: var(--filter-primary);
    font-kerning: none; /* Vypneme kerning pro konzistentní rozestupy */
    display: inline-block; /* Zajišťuje, že nezůstávají mezery */
  }
  .glitch-span{
    position: absolute;
    letter-spacing: 0.08em;
    left: 0%;
    top: 0%;
    width: 1.2ch;
    height: 100%;
    pointer-events: none;
    color: #0ff;
  }
  .glitch-fake1{
    position: absolute;
    letter-spacing: 0.08em;
    left: 0.25%;
    top: 4%;
    width: 100%;
    height: 100%;
    pointer-events: none;
    color: #ff00c8;
  }
  .glitch-fake2 {
      position: absolute;
      letter-spacing: 0.08em;
      left: 0.25%;
      top: 6%;
      width: 100%;
      height: 100%;
      pointer-events: none;
      color: #0ff;
  }

  .glitch-fake1 {
      color: #ff00c8;
      opacity: 0.44;
      text-shadow: 2px 0 #ff00c8, 0 0 10px #ff00c8, 0 0 28px #ff00c8;
      z-index: 1;
      animation: glitchLayer1 2.2s infinite linear alternate;
      pointer-events: none;
  }

  .glitch-fake2 {
      color: #0ff;
      opacity: 0.28;
      text-shadow: -2px 0 #0ff, 0 0 8px #0ff, 0 0 28px #0ff;
      z-index: 2;
      animation: glitchLayer2 1.7s infinite linear alternate;
      pointer-events: none;
  }
  .glitching-word { display: inline-block; white-space: nowrap; position: relative; font-variant-ligatures: none; font-kerning: none; letter-spacing: 0.08em; }
  /* Front layer: cyan neon glow like in the SVG reference */
  #glitch-synthoma .glitch-real {
    color: #0ff;
    text-shadow: 0 0 6px #0ff, 0 0 12px #0ff, 2px 2px 10px rgba(255, 0, 200, 0.35);
    position: relative;
    z-index: 10;
  }
  .glitch-char {
    display: inline; /* inline, aby nevznikaly mezery a vrstvy seděly přes sebe */
    position: relative;
    z-index: 20;
    transition: color 0.06s, filter 0.12s, transform 0.10s;
    will-change: color, filter, transform;
    letter-spacing: 0.08em; /* sjednocení s vrstvami */
    margin: 0;
    padding: 0;
    text-align: inherit;
    box-sizing: content-box;
}

.glitch-char.glitchy {
    color: #f0f; /* magenta záblesk pro vybraný znak */
    filter: blur(1.5px) brightness(2.2);
    text-shadow: 0 0 15px #f0f, 0 0 8px #f0f, 0 0 2px #f0f;
    animation: glitchjump 0.12s linear 2;
    transform: translateY(-2px) scale(1.07) skewX(3deg);
}
  .glitch-word { animation: glitchWordPulse .7s; z-index: 10; }
  
  /* noising & neon */
  .noising-text { -webkit-user-select: none; user-select: none; }

  /* =========================
     INLINE FX (spans in rich text)
     ========================= */
  .fx-glitch {
    display: inline-block;
    position: relative;
    color: currentColor;
    text-shadow: 0 0 6px var(--glow-secondary), 0 0 12px var(--glow-primary);
    animation: fxGlitchPulse 1.1s steps(2,end) infinite;
  }
  @keyframes fxGlitchPulse {
    0%, 100% { transform: translate(0,0); filter: none; }
    50% { transform: translate(0.4px, -0.4px); filter: hue-rotate(8deg) saturate(1.1); }
  }

  .alarm-emote {
    display: inline-block;
    color: currentColor;
    text-shadow: 0 0 8px currentColor, 0 0 16px currentColor;
    animation: alarmPulse 1.1s ease-in-out infinite;
  }
  @keyframes alarmPulse {
    0%, 100% { transform: scale(1); opacity: 0.85; }
    50% { transform: scale(1.08); opacity: 1; }
  }
  .noising-char { transition: all .1s ease-in-out; opacity: 1; color: inherit; text-shadow: inherit; }
  .noising-char.noising { animation: neon-noising .2s ease-in-out infinite alternate; }
  
  /* Inline glitching text (used for @&SĐYŁ token) */
  .glitching { 
    position: relative; 
    display: inline-block; 
    white-space: pre; 
    font: inherit; 
    line-height: inherit; 
    vertical-align: baseline; 
    letter-spacing: 0.12em;
  }

  .glitching-char { 
    display: inline-block;  
    will-change: transform, opacity, text-shadow; 
    vertical-align: baseline; 
    line-height: 0.65em; 
    width: calc(2rem * var(--font-size-multiplier));            /* každý char dostane vlastní “buňku” */
    text-align: center;    /* ať se neváli u kraje */
  }

  .glitching-char.glitch-1 { 
    transform: translate(0.5px, -0.5px); 
    opacity: .95; 
    text-shadow: 0 0 6px var(--glow-secondary); 
  }
  .glitching-char.glitch-2 { 
    transform: translate(-0.5px, 0.5px); 
    opacity: .92; 
    text-shadow: 0 0 8px var(--glow-primary); 
  }
  @keyframes glitch-char-flicker { 0%,100% { opacity: 1 } 50% { opacity: .85 } }
  
  @media (prefers-reduced-motion: reduce) {
    .glitching-char { animation: none !important; transform: none !important; }
  }
  
  /* --- Fixed background layers & Control Panel positioning --- */
  /* Video background pinned to top-left, full viewport, no scroll movement */
  .video-background {
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100dvh;
    overflow: hidden;
    pointer-events: none;
    z-index: 0 !important;
  }
  .video-background video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: left top;
    transform: none !important;
    will-change: opacity;
    opacity: 0;
    transition: opacity .6s ease;
  }
  .video-background video.active { opacity: 1 !important; }

  /* Glitch and noise canvases fixed as well */
  #glitch-bg,
  #noise-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100dvh;
    pointer-events: none;
    z-index: 1;
  }

  /* Control panel toggle button fixed in bottom-right */
  .panel-toggle-button {
    position: fixed;
    right: 1rem;
    bottom: 1rem;
    z-index: 1002;
  }
  /* Control panel region fixed in bottom-right */
  #control-panel {
    position: fixed;
    right: 1rem;
    bottom: 1rem;
    z-index: 1001;
    max-width: min(92vw, 520px);
    pointer-events: auto;
    opacity: 0;
    transform: translateY(12px);
    visibility: hidden;
    transition: opacity .18s ease, transform .18s ease, visibility 0s linear .18s;
  }
  #control-panel.visible {
    opacity: 1;
    transform: none;
    visibility: visible;
    transition: opacity .18s ease, transform .18s ease, visibility 0s;
  }
  
  body.no-animations .glitching-char { animation: none !important; transform: none !important; }
  
  /* Skrytí původních typewriter znaků, když se term obaluje do .glitching */
  .tw-char-hidden { opacity: 0 !important; width: 0 !important; display: inline-block !important; overflow: hidden !important; }
  
  .neon-char { transition: opacity .2s ease-out, text-shadow .3s ease-out; color: rgba(255,255,255,.75); -webkit-user-select: none; user-select: none; }
  .neon-char.bright {
    opacity: 1;
    text-shadow: 0 0 10px var(--accent-primary), 0 0 20px var(--accent-primary),
                 0 0 40px var(--accent-primary), 0 0 80px var(--accent-primary),
                 0 0 120px var(--accent-primary);
  }
  .neon-char.flickering { animation: flicker .1s alternate infinite; }
  .neon-char.flickering-off { opacity: .15 !important; text-shadow: 0 0 2px var(--accent-primary), 0 0 5px var(--accent-secondary) !important; }
  
  /* =========================
     KEYFRAMES (sjednocené)
     ========================= */
  @keyframes spin { to { transform: rotate(360deg); } }
  @keyframes fadeInDelayed { to { opacity: 1; } }
  @keyframes shine { to { left: 120%; } }
  @keyframes progressShine { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
  @keyframes errorShake {
    0%,100% { transform: translateX(0); }
    20% { transform: translateX(-4px); }
    40% { transform: translateX(4px); }
    60% { transform: translateX(-3px); }
    80% { transform: translateX(3px); }
  }
  @keyframes warningBlink { 0%,100% { opacity: 1; } 50% { opacity: .3; } }
  
  @keyframes border-glow {
    0% { opacity: .55; filter: saturate(1) brightness(1); }
    50% { opacity: .8; filter: saturate(1.2) brightness(1.05); }
    100% { opacity: .6; filter: saturate(1.05) brightness(1); }
  }
  
  /* hlavní glitch animace sjednocená (nepřepisuje znaky) */
  @keyframes glitch {
    0% { text-shadow: 2px 0 var(--accent-primary), -2px 0 var(--accent-secondary); transform: translate(-1px, 0); opacity: .8; }
    25% { text-shadow: 3px 2px var(--accent-secondary), -2px -1px var(--accent-primary); transform: translate(1px, 0); opacity: .9; }
    50% { text-shadow: -3px 0 var(--accent-primary), 2px 2px var(--accent-secondary); transform: translate(-1px, 1px); opacity: .7; }
    75% { text-shadow: 2px -2px var(--accent-secondary), -3px 1px var(--accent-primary); transform: translate(1px, -1px); opacity: .8; }
    100% { text-shadow: -2px 2px var(--accent-primary), 3px -2px var(--accent-secondary); transform: translate(0,0); opacity: 1; }
  }
  @keyframes glitchLayer1 {
    0% { transform: translate(0, 0) skewX(0deg); }
    50% { transform: translate(-3px, 1px) skewX(2deg); }
    100% { transform: translate(0, 0) skewX(0deg); }
}

@keyframes glitchLayer2 {
    0% { transform: translate(0, 0) skewY(0deg); }
    60% { transform: translate(-2px, 1px) skewY(-1deg); }
    100% { transform: translate(0, 0) skewY(0deg); }
}

@keyframes glitchjump {
    0% { transform: translateY(0) scale(1) skewX(0deg); }
    40% { transform: translateY(-2px) scale(1.09) skewX(4deg); }
    70% { transform: translateY(2px) scale(.96) skewX(-2deg); }
    100% { transform: translateY(0) scale(1) skewX(0deg); }
  }

  /* Intro animace nadpisu: jemný fade-in, posun a rozsvícení glowa */
  @keyframes glitchIntro {
    0% {
      opacity: 0;
      transform: translateY(10px) scale(0.97);
      text-shadow: 0 0 0 var(--glow-secondary), 0 0 0 var(--glow-primary);
      filter: brightness(0.85) saturate(0.9);
    }
    25% {
      opacity: .8;
      transform: translateY(4px) scale(0.985);
      text-shadow: 0 0 6px var(--glow-secondary), 0 0 12px var(--glow-primary);
      filter: brightness(1) saturate(1);
    }
    45% {
      opacity: 1;
      transform: translateY(0) scale(1.015);
      text-shadow: 0 0 14px var(--glow-secondary), 0 0 26px var(--glow-primary);
      filter: brightness(1.08) saturate(1.1) hue-rotate(8deg);
    }
    60% {
      opacity: 1;
      transform: translateY(0) scale(1.01);
      text-shadow: 0 0 10px var(--glow-secondary), 0 0 22px var(--glow-primary);
      filter: brightness(1.04) saturate(1.06) hue-rotate(-6deg);
    }
    100% {
      opacity: 1;
      transform: none;
      text-shadow: 0 0 6px var(--glow-secondary), 0 0 16px var(--glow-primary), 0 0 36px var(--glow-secondary), 2px 2px 12px var(--glow-primary);
      filter: var(--filter-primary);
    }
  }

  /* Reduced-motion: měkký fade bez pohybu */
  @media (prefers-reduced-motion: reduce) {
    #glitch-synthoma.glitch-master { animation: glitchIntroFade 0.8s ease both, glitch 1.2s infinite linear alternate-reverse; }
    @keyframes glitchIntroFade { from { opacity: 0; } to { opacity: 1; } }
  }

/* Manifest ukazujeme bez CSS gatingu – načasování řeší JS orchestrací v page.tsx */
  @keyframes glitchWordPulse { from { filter: brightness(1); } to { filter: brightness(1.3); } }
  @keyframes alarm-blink { 0% { opacity:.9 } 100% { opacity:.3 } }
  @keyframes alarm-glitch { 0% { transform: skewX(0deg) } 50% { transform: skewX(4deg) } 100% { transform: skewX(0deg) } }
  @keyframes char-glitch-1 { 0% { transform: translateY(0); } 100% { transform: translateY(-1px); } }
  @keyframes char-glitch-2 { 0% { transform: translateX(0); } 100% { transform: translateX(1px); } }
  @keyframes neon-noising { from { filter: brightness(1); } to { filter: brightness(1.8); } }
  @keyframes flicker { from { opacity: 1; } to { opacity: .6; } }
  @keyframes caretBlink { 0%,100% { border-color: transparent } 50% { border-color: var(--accent-primary) } }
  
  /* =========================
     A11Y / REDUCED MOTION
     ========================= */
     .no-animations *,
     .animations-off * {
       transition: none !important;
       animation: none !important;
     }
     .no-animations #glitch-synthoma.glitch-master,
     .no-animations .glitch-fake1,
     .no-animations .glitch-fake2,
     .no-animations .glitch-char,
     .no-animations .glitch-char.glitchy,
     .no-animations .glitch-word,
     .no-animations .alarm-emote,
     .no-animations #glitch-bg,
     .no-animations .neon-char,
     .no-animations .noising-char,
     .no-animations .glitching-char {
       text-shadow: none !important;
       filter: none !important;
       transform: none !important;
       opacity: 1 !important;
     }
     .no-animations .glitch-fake1,
     .no-animations .glitch-fake2 { display: none !important; }
     
  /* =========================
     ARCHIVE – CARD LAYOUT
     ========================= */
  .archive-page {
    position: relative;
    isolation: isolate;
  }
  .archive-story {
    padding-inline: 1rem;
  }
  
  .archive-grid {
    display: grid;
    grid-template-columns: repeat(1, minmax(0, 1fr));
    gap: 1rem;
  }
  @media (min-width: 640px) {
    .archive-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
  }
  @media (min-width: 1024px) {
    .archive-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); }
  }
  
  .archive-card {
    background: rgba(10, 10, 14, 0.55);
    -webkit-backdrop-filter: blur(6px) saturate(1.1);
    backdrop-filter: blur(6px) saturate(1.1);
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.06);
    overflow: clip;
    transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
  }
  .archive-card:hover { transform: translateY(-2px); box-shadow: 0 10px 24px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.08); }
  .archive-card.is-open { border-color: rgba(255,255,255,.2); box-shadow: 0 12px 28px rgba(0,0,0,.5), inset 0 0 0 1px rgba(255,255,255,.1); }
  
  .card-header { padding: 1rem 1rem .5rem; }
  .card-title {
    font-size: calc(1.125rem * var(--font-size-multiplier));
    line-height: 1.2;
    margin: 0 0 .25rem 0;
    letter-spacing: .02em;
    text-shadow: 0 0 10px rgba(0,0,0,.35);
  }
  .card-teaser { margin: 0; color: rgba(255,255,255,.85); font-size: calc(.95rem * var(--font-size-multiplier)); }
  
  .card-media { display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: .5rem; padding: .5rem 1rem 0; }
  .card-media .media { margin: 0; }
  .card-media img { width: 100%; height: auto; border-radius: 10px; display: block; border: 1px solid rgba(255,255,255,.08); }
  .card-media figcaption { font-size: calc(.8rem * var(--font-size-multiplier)); opacity: .85; margin-top: .25rem; }
  
  .card-actions { display: flex; justify-content: flex-end; padding: .25rem 1rem 1rem; }
  .card-toggle { margin-left: auto; }
  
  /* Collapsible content with smooth reveal while keeping DOM accessible */
  .card-content {
    padding: 0 1rem 1rem;
    transition: opacity .2s ease, max-height .25s ease, padding-top .2s ease, padding-bottom .2s ease;
    opacity: 1;
    max-height: 600px; /* enough for typical content; overflow hidden while animating */
  }
  .card-content .text { margin: 0; }
  
  /* hide state: keep display for animation control, but collapse visually */
  .card-content[hidden] {
    display: block;
    opacity: 0;
    max-height: 0;
    overflow: hidden;
    padding-top: 0;
    padding-bottom: 0;
  }
  
  /* Back-to-top alignment inside card */
  .archive-card .back-top { margin: .5rem 0 0; text-align: right; }

  /* Click-capture overlay to open/close card */
  .archive-card { position: relative; }
  .archive-card .card-overlay {
    position: absolute;
    inset: 0;
    background: transparent;
    border: 0;
    padding: 0;
    margin: 0;
    cursor: pointer;
    z-index: 20; /* musí být nad obsahem karty (h3/p mají z-index 10) */
  }

  /* Related chips */
  .archive-card .card-related { margin-top: 1rem; }
  .archive-card .card-related .label { font-size: calc(.85rem * var(--font-size-multiplier)); opacity: .8; margin: 0 0 .25rem; }
  .archive-card .related-list { display: flex; flex-wrap: wrap; gap: .5rem; }
  .archive-card .related-chip {
    border: 1px solid rgba(255,255,255,.2);
    background: rgba(0,0,0,.2);
    color: inherit;
    padding: .25rem .5rem;
    border-radius: 999px;
    cursor: pointer;
    transition: background .2s ease, border-color .2s ease;
  }
  .archive-card .related-chip:hover {
    background: rgba(0, 255, 255, .12);
    border-color: rgba(0, 255, 255, .4);
  }
  .archive-card.is-open .card-overlay { display: none; }

  /* Clickable backdrop button to close when clicking outside the card */
  .archive-backdrop-button {
    position: fixed;
    inset: 0;
    background: transparent; /* vizuální vrstva dělá ::before, tohle jen chytá kliky */
    border: 0;
    padding: 0;
    margin: 0;
    cursor: default;
    z-index: 45; /* nad backdropem (40) i gridem (39), pod otevřenou kartou (50) */
  }

  /* Modal state: center the open card, dim the rest */
  .archive-page.is-modal {
    position: relative;
  }
  .archive-page.is-modal::before {
    content: "";
    position: fixed;
    inset: 0;
    background: rgba(2, 4, 8, .6);
    -webkit-backdrop-filter: blur(2px);
    backdrop-filter: blur(2px);
    z-index: 40; /* stmavení pod klikací backdrop buttonem a pod otevřenou kartou */
  }
  /* V modal stavu: grid nebere kliky; bez z-index aby otevřená karta mohla být nad overlayem */
  .archive-page.is-modal .archive-grid { position: relative; pointer-events: none; }
  .archive-page.is-modal .archive-card { pointer-events: none; opacity: .6; transform: translateY(0) scale(.96); }
  .archive-page.is-modal .archive-card.is-open {
    position: fixed;
    left: 50%; top: 50%;
    transform: translate(-50%, -50%) scale(1);
    width: min(960px, 92vw);
    max-height: 90vh;
    pointer-events: auto;
    overflow: auto;
    z-index: 50;
    opacity: 1; /* otevřená karta je plně neprůhledná */
    background: rgba(6, 10, 14, 0.98); /* mírně tmavší plné pozadí pro čitelnost */
    box-shadow: 0 12px 48px rgba(0,0,0,.55), 0 0 0 1px rgba(255,255,255,.06) inset;
  }
  .archive-page.is-modal .archive-card.is-open .card-header { padding: 1.25rem 1.25rem .75rem; }
  .archive-page.is-modal .archive-card.is-open .card-content { padding: .25rem 1.25rem 1.25rem; max-height: none; }

  /* Close button in modal card */
  .archive-card .card-close {
    position: absolute;
    top: 8px;
    right: 10px;
    z-index: 3;
    border: 1px solid rgba(255,255,255,.2);
    background: rgba(20, 22, 28, .6);
    -webkit-backdrop-filter: blur(4px);
    backdrop-filter: blur(4px);
    color: #fff;
    border-radius: 8px;
    width: 34px; height: 34px;
    line-height: 32px;
    text-align: center;
    font-size: 22px;
    cursor: pointer;
    box-shadow: 0 4px 14px rgba(0,0,0,.35);
  }
  .archive-card .card-close:hover { filter: brightness(1.1); }

  /* =========================
     READER OVERLAY UTILS (no inline styles)
     -------------------------
     Nastavují proměnné pro .SYNTHOMAREADER::before
     ========================= */
  .readerOverlay-none { --bg-image: none; }
  .readerOverlay-blur-xs { --bg-blur: blur(4px); }
  .readerOverlay-blur-sm { --bg-blur: blur(8px); }
  .readerOverlay-blur { --bg-blur: blur(12px); }
  .readerOverlay-blur-lg { --bg-blur: blur(16px); }
  .readerOverlay-10 { --bg-opacity: .10; }
  .readerOverlay-20 { --bg-opacity: .20; }
  .readerOverlay-35 { --bg-opacity: .35; }
  .readerOverlay-50 { --bg-opacity: .50; }
  .readerOverlay-65 { --bg-opacity: .65; }